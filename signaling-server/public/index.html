<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœºå™¨äººè¿œç¨‹ç›‘æ§</title>
    <link rel="stylesheet" href="styles.css">

    <script id="auto-config-script">
        // è‡ªåŠ¨é…ç½®æœåŠ¡å™¨åœ°å€
        document.addEventListener('DOMContentLoaded', function() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host;
            const serverUrl = protocol + '//' + host;
            
            const serverUrlInput = document.getElementById('server-url');
            if (serverUrlInput && !serverUrlInput.value) {
                serverUrlInput.value = serverUrl;
            }
        });
    </script>

    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¤– æœºå™¨äººè¿œç¨‹ç›‘æ§ç³»ç»Ÿ</h1>
            <div class="status-bar">
                <span id="connection-status" class="status disconnected">æœªè¿æ¥</span>
                <span id="webrtc-status" class="status disconnected">WebRTCæœªè¿æ¥</span>
            </div>
        </header>

        <main>
            <!-- è¿æ¥é…ç½®é¢æ¿ -->
            <div id="connection-panel" class="panel">
                <h2>è¿æ¥é…ç½®</h2>
                <div class="form-group">
                    <label for="server-url">ä¿¡ä»¤æœåŠ¡å™¨åœ°å€:</label>
                    <input type="text" id="server-url" value="ws://localhost:3001" placeholder="ws://æœåŠ¡å™¨åœ°å€:ç«¯å£">
                </div>
                <div class="form-group">
                    <label for="room-selection">é€‰æ‹©æœºå™¨äºº:</label>
                    <select id="room-selection">
                        <option value="">ç‚¹å‡»åˆ·æ–°è·å–å¯ç”¨æœºå™¨äºº</option>
                    </select>
                    <button id="refresh-rooms" type="button">ğŸ”„ åˆ·æ–°</button>
                </div>
                <div class="button-group">
                    <button id="connect-btn" type="button">è¿æ¥æœåŠ¡å™¨</button>
                    <button id="disconnect-btn" type="button" disabled>æ–­å¼€è¿æ¥</button>
                </div>
            </div>

            <!-- è§†é¢‘æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="video-panel" class="panel">
                <h2>å®æ—¶è§†é¢‘</h2>
                <div class="video-container">
                    <video id="remote-video" autoplay playsinline muted></video>
                    <div id="video-overlay" class="video-overlay">
                        <div class="overlay-content">
                            <p>ç­‰å¾…è§†é¢‘æµ...</p>
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- è§†é¢‘æ§åˆ¶ -->
                <div class="video-controls">
                    <button id="fullscreen-btn" type="button" disabled>ğŸ” å…¨å±</button>
                    <button id="screenshot-btn" type="button" disabled>ğŸ“· æˆªå›¾</button>
                    <button id="record-btn" type="button" disabled>ğŸ¥ å½•åˆ¶</button>
                    <span class="video-info">
                        <span id="video-resolution">-</span> | 
                        <span id="video-fps">- fps</span> | 
                        <span id="video-bitrate">- kbps</span>
                    </span>
                </div>
            </div>

            <!-- éŸ³é¢‘æ§åˆ¶é¢æ¿ -->
            <div id="audio-panel" class="panel">
                <h2>éŸ³é¢‘æ§åˆ¶</h2>
                <div class="audio-controls">
                    <button id="mute-btn" type="button">ğŸ”Š é™éŸ³</button>
                    <label for="volume-slider">éŸ³é‡:</label>
                    <input type="range" id="volume-slider" min="0" max="100" value="50">
                    <span id="volume-display">50%</span>
                </div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯é¢æ¿ -->
            <div id="stats-panel" class="panel">
                <h2>è¿æ¥ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">è¿æ¥çŠ¶æ€:</span>
                        <span id="stat-connection-state">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ICEçŠ¶æ€:</span>
                        <span id="stat-ice-state">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å»¶è¿Ÿ:</span>
                        <span id="stat-latency">- ms</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ä¸¢åŒ…ç‡:</span>
                        <span id="stat-packet-loss">- %</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ¥æ”¶å¸¦å®½:</span>
                        <span id="stat-bandwidth">- kbps</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¸§ç‡:</span>
                        <span id="stat-framerate">- fps</span>
                    </div>
                </div>
            </div>

            <!-- æ—¥å¿—é¢æ¿ -->
            <div id="log-panel" class="panel collapsible">
                <h2 onclick="togglePanel('log-content')">ğŸ“‹ æ—¥å¿— <span class="toggle-icon">â–¼</span></h2>
                <div id="log-content" class="panel-content">
                    <div class="log-controls">
                        <button id="clear-log" type="button">æ¸…ç©ºæ—¥å¿—</button>
                        <label>
                            <input type="checkbox" id="auto-scroll" checked> è‡ªåŠ¨æ»šåŠ¨
                        </label>
                    </div>
                    <div id="log-messages" class="log-messages"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="webrtc-client.js"></script>
</body>
</html>
